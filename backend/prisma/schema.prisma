generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "mysql"
}

model Role {
  id              Int              @id @default(autoincrement())
  name            String           @unique
  description     String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  rolePermissions RolePermissions?
  users           User[]
}

model Menu {
  id            Int              @id @default(autoincrement())
  title         String           @unique
  icon          String?
  url           String?
  isCollapsible Boolean          @default(false)
  createdAt     DateTime         @default(now())
  updatedAt     DateTime         @updatedAt
  roleMenus     RoleMenuAccess[]
  subMenus      SubMenu[]
}

model SubMenu {
  id           Int                 @id @default(autoincrement())
  title        String
  url          String
  menuId       Int
  createdAt    DateTime            @default(now())
  updatedAt    DateTime            @updatedAt
  roleSubMenus RoleSubMenuAccess[]
  menu         Menu                @relation(fields: [menuId], references: [id])

  @@index([menuId], map: "SubMenu_menuId_fkey")
}

model RolePermissions {
  id        Int              @id @default(autoincrement())
  roleId    Int              @unique
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt
  menus     RoleMenuAccess[]
  role      Role             @relation(fields: [roleId], references: [id])
}

model RoleMenuAccess {
  id                Int                 @id @default(autoincrement())
  rolePermissionsId Int
  menuId            Int
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  menu              Menu                @relation(fields: [menuId], references: [id])
  rolePermissions   RolePermissions     @relation(fields: [rolePermissionsId], references: [id])
  subMenus          RoleSubMenuAccess[]

  @@unique([rolePermissionsId, menuId])
  @@index([menuId], map: "RoleMenuAccess_menuId_fkey")
}

model RoleSubMenuAccess {
  id               Int            @id @default(autoincrement())
  roleMenuAccessId Int
  subMenuId        Int
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  roleMenuAccess   RoleMenuAccess @relation(fields: [roleMenuAccessId], references: [id])
  subMenu          SubMenu        @relation(fields: [subMenuId], references: [id])

  @@unique([roleMenuAccessId, subMenuId])
  @@index([subMenuId], map: "RoleSubMenuAccess_subMenuId_fkey")
}

model User {
  id       Int     @id @default(autoincrement())
  fullName String
  email    String  @unique
  phone    String?
  gender   String?
  password String
  status   String  @default("active")
  photo    String? // ðŸ‘ˆ New field for profile photo

  employee Employee?
  roleId   Int
  role     Role      @relation(fields: [roleId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  transfersPerformed DepartmentTransfer[] @relation("TransfersPerformed")
}

model Employee {
  id           Int        @id @default(autoincrement())
  address      String?
  dob          DateTime?
  status       String     @default("active")
  departmentId Int
  title        String?
  userId       Int        @unique
  department   Department @relation(fields: [departmentId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  transfers DepartmentTransfer[]
}

model Department {
  id             Int        @id @default(autoincrement())
  departmentName String     @unique
  description    String?
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  employees Employee[]
  transfersFrom DepartmentTransfer[] @relation("FromDepartment")
  transfersTo   DepartmentTransfer[] @relation("ToDepartment")
}

model DepartmentTransfer {
  id               Int        @id @default(autoincrement())
  employeeId       Int
  fromDepartmentId Int
  toDepartmentId   Int
  authorizedById   Int?        
  transferDate     DateTime
  reason           String? 
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  employee       Employee   @relation(fields: [employeeId], references: [id])
  fromDepartment Department @relation("FromDepartment", fields: [fromDepartmentId], references: [id])
  toDepartment   Department @relation("ToDepartment", fields: [toDepartmentId], references: [id])
  authorizedBy   User?       @relation("TransfersPerformed", fields: [authorizedById], references: [id])
}

